<!DOCTYPE html>
<html>
<head>
<title>Grocery Shop - Admin</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body{margin:0;font-family:Arial;background:#f5f5f5;}
.header{background:#e60000;color:white;padding:15px;display:flex;justify-content:space-between;align-items:center;}
.header h2{margin:0;}
.main{padding:20px;}
input, select, button{padding:8px;margin:5px;font-size:16px;}
button{background:#ffcc00;border:none;cursor:pointer;border-radius:5px;transition:0.3s;}
button:hover{background:#ffdb4d;}
.products{display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:20px;margin-top:20px;}
.card{background:white;padding:10px;text-align:center;border-radius:8px;box-shadow:0 2px 6px rgba(0,0,0,0.1);}
.card img{width:100%;height:120px;object-fit:cover;border-radius:5px;}
</style>
</head>
<body>

<div class="header"><h2>Admin Panel - Grocery Shop</h2></div>

<div class="main">
    <h3>Add Product</h3>
    <input type="text" id="productName" placeholder="Product Name">
    <input type="text" id="productCategory" placeholder="Category">
    <input type="file" id="productImage">
    <button onclick="addProduct()">Add Product</button>

    <h3>Existing Products</h3>
    <div class="products" id="adminProductList"></div>
</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-storage-compat.js"></script>

<script>
  // Firebase config
  const firebaseConfig = {
    apiKey: "AIzaSyCkYMVn0Jh4Oo8Mgm8WyVAOVe65lSLGeks",
    authDomain: "barrahms-app.firebaseapp.com",
    projectId: "barrahms-app",
    storageBucket: "barrahms-app.appspot.com",
    messagingSenderId: "886499355529",
    appId: "1:886499355529:web:051977ab95fdc3d9b5cf58",
    measurementId: "G-34HG0VVZFY"
  };

  // Initialize Firebase (compat mode)
  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();
  const storage = firebase.storage();

  // Load existing products
  function loadProducts(){
      const adminList = document.getElementById("adminProductList");
      adminList.innerHTML = '';
      db.collection("products").get()
      .then(snapshot => {
          snapshot.forEach(doc => {
              const data = doc.data();
              const card = document.createElement("div");
              card.className = "card";
              card.innerHTML = `
                <img src="${data.imageURL}" alt="${data.name}">
                <h4>${data.name}</h4>
                <p>Category: ${data.category}</p>
                <button onclick="deleteProduct('${doc.id}')">Delete</button>
              `;
              adminList.appendChild(card);
          });
      }).catch(err => console.error(err));
  }

  loadProducts();

  // Add Product
  function addProduct(){
      const name = document.getElementById("productName").value.trim();
      const category = document.getElementById("productCategory").value.trim();
      const file = document.getElementById("productImage").files[0];

      if(!name || !category || !file){
          alert("All fields are required!");
          return;
      }

      // Upload image to Firebase Storage
      const storageRef = storage.ref('products/' + file.name);
      const uploadTask = storageRef.put(file);

      uploadTask.on('state_changed', 
        function(snapshot){},
        function(error){
            console.error("Upload failed:", error);
        },
        function(){
            // Upload complete
            uploadTask.snapshot.ref.getDownloadURL().then(function(downloadURL){
                // Save product info to Firestore
                db.collection("products").add({
                    name: name,
                    category: category,
                    imageURL: downloadURL
                }).then(() => {
                    alert("Product added successfully!");
                    document.getElementById("productName").value = '';
                    document.getElementById("productCategory").value = '';
                    document.getElementById("productImage").value = '';
                    loadProducts();
                }).catch(err => console.error(err));
            });
        }
      );
  }

  // Delete Product
  function deleteProduct(id){
      if(confirm("Are you sure you want to delete this product?")){
          db.collection("products").doc(id).delete()
          .then(() => loadProducts())
          .catch(err => console.error(err));
      }
  }
</script>
</body>
</html>
