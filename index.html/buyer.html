<!DOCTYPE html>
<html>
<head>
<title>Buyer - Online Grocery Shop</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body{margin:0;font-family:Arial;background:#f5f5f5;}
.menu-btn,.home-btn{padding:6px 10px;margin-right:5px;border:none;cursor:pointer;font-weight:bold;}
.menu-btn{background:white;}
.home-btn{background:#ffcc00;}
.header{background:#e60000;color:white;padding:15px;display:flex;justify-content:space-between;align-items:center;}
.search-box input{padding:8px;width:200px;}
.container{display:flex;}
.sidebar{width:200px;background:white;padding:20px;display:block;}
.sidebar ul{list-style:none;padding:0;}
.sidebar li{padding:8px 0;cursor:pointer;}
.sidebar li:hover{color:red;}
.main{flex:1;padding:20px;}
.products{display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:20px;}
.card{background:white;padding:10px;text-align:center;border-radius:8px;cursor:pointer;}
.card img{width:100%;height:120px;object-fit:cover;}
.card button{margin-top:8px;padding:6px 10px;background:#ffcc00;border:none;cursor:pointer;}
.cart{position:fixed;right:20px;top:100px;background:red;color:white;padding:10px;border-radius:8px;}
.modal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.5);justify-content:center;align-items:center;}
.modal-content{background:white;padding:20px;width:300px;position:relative;}
.modal-content input{width:100%;padding:6px;margin:5px 0;}
.modal-close{position:absolute;top:5px;right:10px;cursor:pointer;font-weight:bold;color:red;}
#imageModal img{width:100%;height:auto;}
.tab-btns button{padding:6px 10px;margin-right:5px;cursor:pointer;}
.tab-btns button.active{background:#ffcc00;}
</style>
</head>
<body>

<div class="header">
    <div>
        <button class="menu-btn" onclick="toggleMenu()">☰</button>
        <button class="home-btn" onclick="goHome()">Home</button>
    </div>
    <h2>Grocery Shop</h2>
    <div class="search-box">
        <input type="text" id="searchInput" placeholder="Search..." onkeyup="searchProduct()">
    </div>
    <button onclick="openAuthModal()">Login/Sign Up</button>
</div>

<div class="container">
    <div class="sidebar" id="sidebar">
        <h3>Category</h3>
        <ul>
            <li onclick="filterCategory('Food')">Food</li>
            <li onclick="filterCategory('Drink')">Drink</li>
            <li onclick="filterCategory('Frozen')">Frozen</li>
            <li onclick="filterCategory('Mobile')">Mobile</li>
            <li onclick="filterCategory('All')">All</li>
        </ul>
    </div>

    <div class="main">
        <div class="products" id="productList"></div>
        <div class="cart">
            Cart: <span id="cart-count">0</span>
        </div>
    </div>
</div>

<!-- Buyer Modal -->
<div class="modal" id="buyerModal">
    <div class="modal-content">
        <span class="modal-close" onclick="closeModal('buyerModal')">×</span>
        <h3>Buyer Details</h3>
        <input type="text" id="name" placeholder="Full Name">
        <input type="text" id="phone" placeholder="Phone Number">
        <input type="text" id="address" placeholder="Address">
        <button onclick="submitOrder()">Submit</button>
    </div>
</div>

<!-- Auth Modal -->
<div class="modal" id="authModal">
    <div class="modal-content">
        <span class="modal-close" onclick="closeModal('authModal')">×</span>
        <div class="tab-btns">
            <button id="signupTab" class="active" onclick="switchTab('signup')">Sign Up</button>
            <button id="loginTab" onclick="switchTab('login')">Login</button>
        </div>
        <div id="signupForm">
            <input type="text" id="signupUsername" placeholder="Username">
            <input type="email" id="signupEmail" placeholder="Email">
            <input type="password" id="signupPassword" placeholder="Password">
            <button onclick="registerUser()">Register</button>
        </div>
        <div id="loginForm" style="display:none;">
            <input type="email" id="loginEmail" placeholder="Email">
            <input type="password" id="loginPassword" placeholder="Password">
            <button onclick="loginUser()">Login</button>
        </div>
    </div>
</div>

<!-- Image Modal -->
<div class="modal" id="imageModal">
    <div class="modal-content">
        <span class="modal-close" onclick="closeModal('imageModal')">×</span>
        <img id="modalImage" src="">
        <h4 id="modalTitle"></h4>
    </div>
</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-storage-compat.js"></script>
<script>
const firebaseConfig = {
  apiKey: "AIzaSyCkYMVn0Jh4Oo8Mgm8WyVAOVe65lSLGeks",
  authDomain: "barrahms-app.firebaseapp.com",
  projectId: "barrahms-app",
  storageBucket: "barrahms-app.firebasestorage.app",
  messagingSenderId: "886499355529",
  appId: "1:886499355529:web:051977ab95fdc3d9b5cf58",
  measurementId: "G-34HG0VVZFY"
};

// Initialize Firebase
const app = initializeApp(firebaseConfig);
const analytics = getAnalytics(app);
let count = 0;

// Load products from Firestore
function loadProducts(){
    const productList = document.getElementById("productList");
    productList.innerHTML = "";
    db.collection("products").get().then(snapshot=>{
        snapshot.forEach(doc=>{
            const data = doc.data();
            const card = document.createElement("div");
            card.className = "card";
            card.dataset.category = data.category;
            card.onclick = ()=>openImage(card);
            card.innerHTML = `<img src="${data.imageUrl}"><h4>${data.name}</h4>
            <button onclick="event.stopPropagation(); buyProduct()">Add to Cart</button>`;
            productList.appendChild(card);
        });
    });
}
loadProducts();

// Buyer functions
function buyProduct(){document.getElementById("buyerModal").style.display="flex";}
function submitOrder(){
    let name=document.getElementById("name").value;
    let phone=document.getElementById("phone").value;
    let address=document.getElementById("address").value;
    if(name && phone && address){
        db.collection("orders").add({name,phone,address,time:firebase.firestore.FieldValue.serverTimestamp()})
        .then(()=>{count++;document.getElementById("cart-count").innerText=count;alert("Order Successful!");closeModal('buyerModal');})
        .catch(err=>alert(err));
    } else alert("Fill all details!");
}

// Auth functions
function openAuthModal(){document.getElementById("authModal").style.display="flex";}
function switchTab(tab){
    document.getElementById("signupForm").style.display=(tab==='signup')?'block':'none';
    document.getElementById("loginForm").style.display=(tab==='login')?'block':'none';
    document.getElementById("signupTab").className=(tab==='signup')?'active':'';
    document.getElementById("loginTab").className=(tab==='login')?'active':'';
}
function registerUser(){
    let email=document.getElementById("signupEmail").value;
    let password=document.getElementById("signupPassword").value;
    auth.createUserWithEmailAndPassword(email,password).then(()=>{alert("User Registered!");closeModal('authModal');}).catch(err=>alert(err.message));
}
function loginUser(){
    let email=document.getElementById("loginEmail").value;
    let password=document.getElementById("loginPassword").value;
    auth.signInWithEmailAndPassword(email,password).then(()=>{alert("Login Successful!");closeModal('authModal');}).catch(err=>alert(err.message));
}

// Image modal
function openImage(card){
    document.getElementById("modalImage").src=card.querySelector("img").src;
    document.getElementById("modalTitle").innerText=card.querySelector("h4").innerText;
    document.getElementById("imageModal").style.display="flex";
}
function closeModal(id){document.getElementById(id).style.display="none";}

// Other UI
function filterCategory(category){document.querySelectorAll(".card").forEach(c=>c.style.display=(category==='All'||c.dataset.category===category)?'block':'none');}
function goHome(){filterCategory('All');}
function toggleMenu(){let s=document.getElementById("sidebar");s.style.display=(s.style.display==='none')?'block':'none';}
function searchProduct(){let input=document.getElementById("searchInput").value.toLowerCase();document.querySelectorAll(".card").forEach(c=>c.style.display=c.innerText.toLowerCase().includes(input)?'block':'none');}
</script>
</body>
</html>
